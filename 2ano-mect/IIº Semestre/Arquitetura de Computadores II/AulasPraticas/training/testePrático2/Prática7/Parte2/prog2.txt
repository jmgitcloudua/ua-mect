#include <detpic32.h>

//PWM function
void setPWM(unsigned int dutyCycle){
  if(dutyCycle > 100){
     return;
   }else{
    OC1RS = 500*dutyCycle;//OC1RS = (PR3+1)*(dutyCycle/100)
   }
}
//configure Timer 3
void configTimer3(){
 T3CONbits.TCKPS = 2;//Kpresc = 2; | fout_presc = 5MHz
 PR3 = 49999; //PR3 = fout_presc /fout - 1
 TMR3 = 0; //reset Timer3 counter
 T3CONbits.TON = 1;//enable Timer3

 OC1CONbits.OCM = 6; //PWM mode on OC1 fault pin disabled
 OC1CONbits.OCTSEL = 1;//Timer3 is the clock sourde for PWM
 OC1RS = 12500; //OC1RS constat duty-cycle = 25%
 OC1CONbits.ON=1;//enable OC1 module
}
int main(void){
 
 configTimer3();

 while(1){
  setPWM(90);
 }

 return 0;
}